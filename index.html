<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="height=device-height, width=device-width, initial-scale=1">
<title>Nox</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{color-scheme:dark;font-family:"Roboto","Segoe UI",sans-serif;background:#040507}
body{margin:0;background:#040507;color:#fff}
#canvas{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000}
#progress-container {
    width: min(320px, 80vw);
    height: 24px;
    background: #1a1a1a;
    border: 3px solid #3a3a3a;
    position: relative;
    margin: 0 auto;
    image-rendering: pixelated;
    -moz-image-rendering: crisp-edges;
    image-rendering: crisp-edges;
    box-shadow: 
        0 0 0 2px #000,
        inset 0 0 0 2px #000;
}

#progress-bar {
    position: absolute;
    top: 3px;
    left: 3px;
    bottom: 3px;
    width: 0%;
    background: 
        repeating-linear-gradient(
            90deg,
            #8b7355 0px,
            #8b7355 4px,
            #a88a65 4px,
            #a88a65 8px
        );
    transition: width 0.1s linear;
    box-shadow: 
        inset 2px 0 0 #d4af37,
        inset -2px 0 0 #5d4c2e;
}

#progress-frame {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        repeating-linear-gradient(
            90deg,
            transparent 0px,
            transparent 15px,
            rgba(0, 0, 0, 0.3) 15px,
            rgba(0, 0, 0, 0.3) 16px
        );
    pointer-events: none;
}

.progress-decoration {
    position: absolute;
    top: -6px;
    bottom: -6px;
    width: 10px;
    background: #5d4c2e;
    border: 2px solid #3a3a3a;
    image-rendering: pixelated;
}

.progress-decoration.left {
    left: -12px;
}

.progress-decoration.right {
    right: -12px;
}

.nox{text-align:center;color:#fff;font-size:14px;padding:20vh 24px 0}
.emscripten{display:flex;flex-direction:column;align-items:center;gap:12px}
#status{margin:0 0 20px;min-height:1.5em;font-size:12px;color:#fff;font-family:"Press Start 2P","Courier New",monospace;text-transform:uppercase;letter-spacing:0;text-shadow:2px 2px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000;image-rendering:pixelated;-moz-image-rendering:crisp-edges;image-rendering:crisp-edges;-webkit-font-smoothing:none;-moz-osx-font-smoothing:unset;font-smooth:never}
.bttn{display:inline-flex;align-items:center;justify-content:center;padding:0 32px;line-height:42px;border-radius:6px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;border:none;background:linear-gradient(135deg,#4d5dff,#9430ff);color:#fff;cursor:pointer;transition:transform 120ms ease,box-shadow 120ms ease;box-shadow:0 0 22px rgba(77,93,255,.45)}
.bttn:hover{transform:translateY(-1px);box-shadow:0 10px 28px rgba(148,48,255,.35)}
.emscripten_border{position:fixed;inset:0;pointer-events:none}
.run-game{position:relative;z-index:2}
.backdrop{position:fixed;inset:0;z-index:1;background:radial-gradient(circle at top,rgba(99,105,255,.25),transparent 55%),radial-gradient(circle at bottom,rgba(148,48,255,.25),transparent 55%);pointer-events:none}

#original-progress {
    display: none;
}
</style>
</head>
<body>
<div class="backdrop" aria-hidden="true"></div>
<div class="run-game nox">
<div class="spinner" id="spinner" style="display:none"></div>
<div class="emscripten" id="status"></div>
<div class="emscripten">
    <progress value="0" max="100" id="original-progress"></progress>
    
    <div id="progress-container">
        <div class="progress-decoration left"></div>
        <div class="progress-decoration right"></div>
        <div id="progress-bar"></div>
        <div id="progress-frame"></div>
    </div>
</div>
<div class="emscripten_border"><canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas></div>
</div>
<script src="hangul.min.js"></script>
<script>
const statusElement=document.getElementById("status"),
      progressElement=document.getElementById("original-progress"),
      progressBar=document.getElementById("progress-bar"),
      progressContainer=document.getElementById("progress-container"),
      spinnerElement=document.getElementById("spinner"),
      canvas=document.getElementById("canvas");

function isMobile(){const ua=navigator.userAgent||"";return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)}
function resumeAudioIfNeeded(){const SDL2=window.Module&&window.Module.SDL2;if(!SDL2)return;const ctx=SDL2.audioContext;if(ctx&&typeof ctx.resume==="function"&&ctx.state==="suspended"){ctx.resume().catch(()=>{})}}
["pointerdown","touchend","keydown"].forEach((e)=>{window.addEventListener(e,resumeAudioIfNeeded,{passive:true})});
function ensureFullscreenOnTouch(){if(!isMobile())return;const r=canvas.requestFullscreen||canvas.webkitRequestFullScreen||canvas.msRequestFullscreen;if(!r)return;canvas.addEventListener("touchstart",()=>{if(!document.fullscreenElement){r.call(canvas)}},{passive:true})}

var Module=window.Module||{};
Object.assign(Module,{
    preRun:[],
    postRun:[],
    canvas,
    locateFile:(p)=>p,
    print:(()=>{return function(t){if(arguments.length>1){t=Array.prototype.slice.call(arguments).join(" ")}console.log(t)}})(),
    printErr:function(t){if(arguments.length>1){t=Array.prototype.slice.call(arguments).join(" ")}console.error(t)},
    setStatus:function(t){
        if(!Module.setStatus.last){Module.setStatus.last={time:Date.now(),text:""}}
        if(t===Module.setStatus.last.text)return;
        const m=t&&t.match(/([^(]+)\((\d+(?:\.\d+)?)\/(\d+)\)/);
        const n=Date.now();
        if(m&&n-Module.setStatus.last.time<30)return;
        Module.setStatus.last.time=n;
        Module.setStatus.last.text=t;
        if(m){
            const[,msg,loaded,total]=m;
            statusElement.textContent="LOADING...";
            const p=(parseFloat(loaded)/parseFloat(total))*100;
            progressElement.value=p;
            progressBar.style.width=p+"%";
            progressContainer.style.display="block";
            spinnerElement.hidden=false;
        }else{
            statusElement.textContent=t||"LOADING...";
            if(t){
                progressContainer.style.display="block";
                if(!progressElement.value||progressElement.value===0){
                    progressElement.value=0;
                    progressBar.style.width="0%";
                }
            }else{
                progressContainer.style.display="none";
            }
            if(!t){
                spinnerElement.style.display="none";
                canvas.style.visibility=""
            }
        }
    },
    monitorRunDependencies:function(l){
        this.totalDependencies=Math.max(this.totalDependencies||0,l);
        if(l){
            const loaded=this.totalDependencies-l;
            const p=this.totalDependencies>0?(loaded/this.totalDependencies)*100:0;
            progressElement.value=p;
            progressBar.style.width=p+"%";
            progressContainer.style.display="block";
            Module.setStatus("LOADING... ("+loaded+"/"+this.totalDependencies+")")
        }else{
            progressElement.value=100;
            progressBar.style.width="100%";
            Module.setStatus("LOADING...")
        }
    },
    setProgress:function(l,t){
        if(t>0){
            const p=(l/t)*100;
            progressElement.value=p;
            progressBar.style.width=p+"%";
            progressContainer.style.display="block";
            statusElement.textContent="LOADING..."
        }
    },
    ingameWidth:function(){
        if(canvas.width)return canvas.width;
        if(canvas.clientWidth)return Math.round(canvas.clientWidth*(window.devicePixelRatio||1));
        return isMobile()?848:1024
    },
    ingameHeight:function(){
        if(canvas.height)return canvas.height;
        if(canvas.clientHeight)return Math.round(canvas.clientHeight*(window.devicePixelRatio||1));
        if(isMobile())return 480;
        return window.location.search.includes("nowidescreen")?768:576
    },
    shouldRotate:function(){return isMobile()},
    setWindowTitle:function(t){if(typeof t==="string"&&t.trim()){document.title=t.trim()}}
});

window.Module=Module;
Module.postRun.push(()=>{
    canvas.style.visibility="visible";
    statusElement.textContent="";
    progressContainer.style.display="none";
    resumeAudioIfNeeded()
});

canvas.style.visibility="hidden";
progressElement.value=0;
progressBar.style.width="0%";
progressContainer.style.display="block";
Module.setStatus("LOADING...");
ensureFullscreenOnTouch();

window.addEventListener("error",(e)=>{Module.setStatus("LOADING...");spinnerElement.style.display="none";canvas.style.visibility="hidden"},true);

const originalAddEventListener=EventTarget.prototype.addEventListener;
EventTarget.prototype.addEventListener=function(t,l,o){return originalAddEventListener.call(this,t,l,o)};

function loadGameBundle(){
    if(document.querySelector("script[data-nox-bundle]"))return;
    Module.setStatus("LOADING...");
    const b=canvas.parentElement;
    if(b){b.style.pointerEvents="auto"}
    const s=document.createElement("script");
    s.type="text/javascript";
    s.async=true;
    s.dataset.noxBundle="out";
    s.src="out.js";
    s.onload=()=>{
        try{
            const baseUrl=new URL("./",s.src||window.location.href);
            const originalReadAsync=Module.readAsync;
            let totalFiles=0,loadedFiles=0;
            if(Module.readAsync){
                Module.readAsync=(url,onload,onerror)=>{
                    totalFiles++;
                    progressContainer.style.display="block";
                    const resolved=new URL(url,baseUrl).href;
                    const originalOnload=onload;
                    const wrappedOnload=(data)=>{
                        loadedFiles++;
                        const p=totalFiles>0?(loadedFiles/totalFiles)*100:0;
                        progressElement.value=Math.min(p,100);
                        progressBar.style.width=Math.min(p,100)+"%";
                        if(originalOnload)originalOnload(data)
                    };
                    return originalReadAsync(resolved,wrappedOnload,onerror)
                }
            }
            if(typeof fetch!=='undefined'){
                const originalFetch=window.fetch;
                window.fetch=function(...args){
                    const url=args[0];
                    if(typeof url==='string'&&(url.endsWith('.pak')||url.endsWith('.dat')||url.endsWith('.wnd')||url.includes('assets'))){
                        totalFiles++;
                        progressContainer.style.display="block";
                        return originalFetch.apply(this,args).then(response=>{
                            if(response.ok){
                                loadedFiles++;
                                const p=totalFiles>0?(loadedFiles/totalFiles)*100:0;
                                progressElement.value=Math.min(p,100);
                                progressBar.style.width=Math.min(p,100)+"%";
                            }
                            return response
                        })
                    }
                    return originalFetch.apply(this,args)
                }
            }
            if(typeof XMLHttpRequest!=='undefined'){
                const OriginalXHR=window.XMLHttpRequest;
                window.XMLHttpRequest=function(){
                    const xhr=new OriginalXHR();
                    const originalOpen=xhr.open;
                    xhr.open=function(method,url,...rest){
                        if(typeof url==='string'&&(url.endsWith('.pak')||url.endsWith('.dat')||url.endsWith('.wnd')||url.includes('assets'))){
                            totalFiles++;
                            progressContainer.style.display="block";
                            xhr.addEventListener('loadend',function(){
                                if(xhr.readyState===4&&xhr.status>=200&&xhr.status<300){
                                    loadedFiles++;
                                    const p=totalFiles>0?(loadedFiles/totalFiles)*100:0;
                                    progressElement.value=Math.min(p,100);
                                    progressBar.style.width=Math.min(p,100)+"%";
                                }
                            })
                        }
                        return originalOpen.apply(this,[method,url,...rest])
                    };
                    return xhr
                }
            }
        }catch(error){console.error("Failed to override Module.readAsync:",error)}
        Module.setStatus("LOADING...")
    };
    s.onerror=(e)=>{console.error("Error loading out.js",e);Module.setStatus("LOADING...")};
    document.body.appendChild(s)
}

resumeAudioIfNeeded();
loadGameBundle();
</script>
</body>
</html>